// Generated by CoffeeScript 1.6.2
var add_to_list, check_if_no_records, remove_record_from_page, set_viewed_icon, set_viewed_icon_and_remove_buttons, show_torrents;

remove_record_from_page = function(id) {
  return $('#record' + id).fadeOut('fast', function() {
    $(this).remove();
    return check_if_no_records();
  });
};

add_to_list = function(movie_id, list_id, record_id) {
  return $.post(url_ajax_add_to_list, {
    movie_id: movie_id,
    list_id: list_id
  }, function(data) {
    return set_viewed_icon_and_remove_buttons(record_id, list_id);
  }).error(function() {
    return displayError('Ошибка добавления фильма в список.');
  });
};

check_if_no_records = function() {
  if (!$('.movie').length) {
    return $('#results').html('Список пуст.');
  }
};

set_viewed_icon_and_remove_buttons = function(record_id, list_id) {
  var remove_buttons;

  remove_buttons = function() {
    return $('#record' + record_id).children('.buttons').html('');
  };
  set_viewed_icon(record_id, list_id);
  if (list_id !== 0) {
    return remove_buttons();
  }
};

set_viewed_icon = function(record_id, list_id) {
  var html, icon, title;

  if (list_id === 0) {
    return;
  } else if (list_id === 1) {
    icon = 'open';
    title = 'Просмотрено';
  } else if (list_id === 2) {
    icon = 'close';
    title = 'К просмотру';
  }
  html = '<i class="icon-eye-' + icon + '" title="' + title + '"></i>';
  return $('#record' + record_id).children('.title').prepend(html);
};

show_torrents = function(query) {
  var get_torrents;

  get_torrents = function(query) {
    var bytes_to_size;

    bytes_to_size = function(bytes, precision) {
      var gigabyte, kilobyte, megabyte, terabyte;

      kilobyte = 1024;
      megabyte = kilobyte * 1024;
      gigabyte = megabyte * 1024;
      terabyte = gigabyte * 1024;
      if ((bytes >= 0) && (bytes < kilobyte)) {
        return bytes + ' B';
      } else if ((bytes >= kilobyte) && (bytes < megabyte)) {
        return (bytes / kilobyte).toFixed(precision) + ' KB';
      } else if ((bytes >= megabyte) && (bytes < gigabyte)) {
        return (bytes / megabyte).toFixed(precision) + ' MB';
      } else if ((bytes >= gigabyte) && (bytes < terabyte)) {
        return (bytes / gigabyte).toFixed(precision) + ' GB';
      } else if (bytes >= terabyte) {
        return (bytes / terabyte).toFixed(precision) + ' TB';
      } else {
        return bytes + ' B';
      }
    };
    return $.ajax({
      type: 'POST',
      url: url_ajax_download,
      data: {
        query: query
      },
      success: function(json) {
        var html, i, total_lists;

        json = $.parseJSON(json.data);
        total_lists = json.items.list.length;
        if (total_lists === 0) {
          return $("#torrents").html('Торрентов не найдено.');
        } else {
          html = '<ul>';
          i = 0;
          while (i < total_lists) {
            html += '<li id="searchresult-' + i + '"><a href="' + json.items.list[i].uri + '" target="_blank">' + json.items.list[i].title + '</a> &#8593; ' + json.items.list[i].Seeds + ' &#8595; ' + json.items.list[i].leechers + '<br>' + json.items.list[i].tracker + ' &mdash; ' + bytes_to_size(json.items.list[i].size, 2) + ' &mdash; ' + json.items.list[i].regtime + '</li>';
            i++;
          }
          html += '</ul>';
          return $("#torrents").html(html);
        }
      },
      async: false
    }).error(function() {
      return displayError('Ошибка поиска торрентов.');
    });
  };
  get_torrents(query);
  $('#myModal').modal('toggle');
  return void 0;
};
